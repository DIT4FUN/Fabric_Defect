## 软件设计文档

### 程序主结构设计
#### 布料类型检测

1.	图像预处理	
2.	裁剪指定张图像，充当数据集
3.	对数据集数据增强
4.	监督学习训练
5.	预测结果

#### 瑕疵检测
1.图像预处理
> - 使用上下采样突出各瑕疵特征。
> - 边缘检测获取瑕疵轮廓。
> - 向下采样获得瑕疵位置。

2.半监督循环扩充数据集
> - 使用自研TorNN半监督辅助分类算法，对第一阶段预测数据进行保守分类。
> - 如果保守分类得到数据较少，则调整TorNN扩充参数，提升分类数据量。直到数据量达到阈值则终止循环。
> -对得到的数据集进行数据增强操作。

3.半监督深度学习训练

> - 使用扩充得到的数据集放入神经网络进行第二阶段训练。

4.对所有数据集进行瑕疵分类

> - 对所有含有瑕疵的图片进行预测分类。

5.在原始图像中标记瑕疵所在位置

> - 利用绘图工具和预测结果，在原始图像中进行标记。
### 关联算法设计
1.图片预处理模块
> - 首先对原始图像进行不同比例的采样，暂定方案为`0.1、0.065、0.3、0.8、1、2`5种比例进行采样。
> - 使用Canny算子进行边缘检测，阈值设置为`[:30],[70:]`。
> - 对0.065、0.3、0.8比例下的二值化图像进行合并，得到总体图像特征。

2.网络模型设计

> 暂定使用ResNet的移动设备版神经网络--mobilenet_v2
![mobilenet_v2][1]

3.调用机制设计
> - get 请求调用：需要将待预测图片转换为Base64模式，以字符串类型传递给服务器接口。`返回Json格式数据[该方案暂定]`
> 
> - AI studio预测服务：需要将待预测图片转换为Base64模式，以字符串类型传递给百度AI studio接口。`返回Json格式数据[该方案暂定]`
> - 使用Fluid异步数据读取模式，在本地物理机上直接预测出结果。`直接返回预测结果[该方案暂定]`
> - Debug模式调用：执行预测的可执行文件，传入目标文件路径。`返回结果并渲染结果图[当前方案]`


  [1]: https://wx2.sinaimg.cn/mw690/df5193a5ly1g3jl38ldivj20d90eb0ts.jpg